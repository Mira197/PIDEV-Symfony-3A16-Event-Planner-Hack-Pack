{% extends 'admin/baseAdmin.html.twig' %}
{% block head %}
	<link rel="stylesheet" href="{{ asset('assetsAya/css/adminOrder.css') }}">
	{{ parent() }}
{% endblock %}

{% block section %}
	<div class="admin-mui-wrapper">
		<h2>üìÖ Manage Bookings</h2>

		<!-- Barre de recherche -->
		<div class="admin-filters">
			<div class="left-search">
				<input type="text" id="bookingSearchInput" placeholder="üîç Search bookings..." class="form-control">
			</div>
		</div>

		<table class="admin-mui-table">
			<thead>
				<tr>
					<th>Event</th>
					<th>Location</th>
					<th>Start Date</th>
					<th>End Date</th>
					<th>Actions</th>
				</tr>
			</thead>

			<tbody id="bookingsTable">
				{% for booking in bookings %}
					<tr>
						<td>{{ booking.event.name }}</td>
						<td>{{ booking.location.name }}</td>
						<td>{{ booking.startDate|date('Y-m-d H:i') }}</td>
						<td>{{ booking.endDate|date('Y-m-d H:i') }}</td>
						<td>
							<a href="{{ path('booking_admin_edit', { 'id': booking.idBooking }) }}" class="btn btn-outline-warning btn-sm">üñäÔ∏è</a>
							{{ include('admin/booking_admin/delete_formBookingAdmin.html.twig') }}
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="5" class="empty-row">No bookings found.</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
{% endblock %}
{% block javascripts %}
{{ parent() }}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        $('#bookingSearchInput').on('keyup', function () {
            let query = $(this).val();

            if (query.trim() === '') {
                window.location.reload();
                return;
            }

            $.ajax({
                url: "{{ path('booking_ajax_search') }}",
                type: 'GET',
                data: { q: query },
                success: function (data) {
                    let tbody = $('#bookingsTable');
                    tbody.empty();

                    if (data.length === 0) {
                        tbody.append('<tr><td colspan="5">No bookings found.</td></tr>');
                        return;
                    }

                    data.forEach(function (booking) {
                        tbody.append(`
                            <tr>
                            <td>${booking.event.name}</td>
                            <td>${booking.location.name}</td>
                            <td>${booking.startDate}</td>
                            <td>${booking.endDate}</td>
                            <td>
                                <a href="/admin/booking/${booking.idBooking}/edit" class="btn btn-outline-warning btn-sm">üñäÔ∏è</a>
                                {#<em class="text-muted">Reload page to delete</em>#}
                            </td>
                        </tr>
                        `);
                    });
                },
                error: function () {
                    alert("Error fetching booking results.");
                }
            });
        });
    });
</script>
{% endblock %}

