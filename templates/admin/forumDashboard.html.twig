{% extends 'admin/baseAdmin.html.twig' %}

{% block section %}
    <section class="section">
        <div class="container-fluid">
            <!-- ========== title-wrapper start ========== -->
            <div class="title-wrapper pt-30">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="title">
                            <h2>Forum Dashboard</h2>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="breadcrumb-wrapper">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="#0">Dashboard</a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        Forum
                                    </li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ========== title-wrapper end ========== -->

            <div class="row">
                <!-- Total Posts -->
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="icon-card mb-30">
                        <div class="icon purple">
                            <i class="lni lni-pencil-alt"></i>
                        </div>
                        <div class="content">
                            <h6 class="mb-10">Total Posts</h6>
                            <h3 class="text-bold mb-10">{{ totalPosts }}</h3>
                            <p class="text-sm text-success">
                                <i class="lni lni-arrow-up"></i>
                                +3.4%
                                <span class="text-gray">(Monthly)</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Total Comments -->
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="icon-card mb-30">
                        <div class="icon success">
                            <i class="lni lni-comments"></i>
                        </div>
                        <div class="content">
                            <h6 class="mb-10">Total Comments</h6>
                            <h3 class="text-bold mb-10">{{ totalComments }}</h3>
                            <p class="text-sm text-success">
                                <i class="lni lni-arrow-up"></i>
                                +1.8%
                                <span class="text-gray">(Engagement)</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Reported Posts -->
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="icon-card mb-30">
                        <div class="icon danger">
                            <i class="lni lni-warning"></i>
                        </div>
                        <div class="content">
                            <h6 class="mb-10">Reported Posts</h6>
                            <h3 class="text-bold mb-10">{{ reportedPosts }}</h3>
                            <p class="text-sm text-danger">
                                <i class="lni lni-arrow-down"></i>
                                -1.2%
                                <span class="text-gray">(Pending)</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Active Users -->
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="icon-card mb-30">
                        <div class="icon primary">
                            <i class="lni lni-users"></i>
                        </div>
                        <div class="content">
                            <h6 class="mb-10">Active Users</h6>
                            <h3 class="text-bold mb-10">{{ activeUsers }}</h3>
                            <p class="text-sm text-success">
                                <i class="lni lni-arrow-up"></i>
                                +4.2%
                                <span class="text-gray">(This week)</span>
                            </p>
                        </div>
                    </div>
                </div>

               <!-- Sentiment Overview -->
            <div class="row">
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="icon-card mb-30">
                        <div class="icon info">
                            <i class="lni lni-emoji-smile"></i>
                        </div>
                        <div class="content">
                            <h6 class="mb-10">User Sentiment</h6>
                            <h3 class="text-bold mb-10">Overview</h3>
                            <p class="text-sm">
                                <span class="text-success">üòä {{ sentimentStats.positive }}% Positive</span><br>
                                <span class="text-danger">üòî {{ sentimentStats.negative }}% Negative</span><br>
                                <span class="text-muted">üòê {{ sentimentStats.neutral }}% Neutral</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sentiment Distribution Chart -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="card-style mb-30">
                        <div class="title d-flex flex-wrap align-items-center justify-content-between">
                            <div class="left">
                                <h6 class="text-medium mb-10">Sentiment Distribution</h6>
                            </div>
                            <div class="right">
                                <div class="select-style-1">
                                    <div class="select-position select-sm">
                                        <select class="light-bg" id="sentimentFilter">
                                            <option value="all">All Time</option>
                                            <option value="month">Last Month</option>
                                            <option value="week">Last Week</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart">
                            <canvas id="sentimentChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Autres sections existantes -->
            <div class="row">
                <div class="col-lg-7">
                    <div class="card-style mb-30">
                        <div class="title d-flex flex-wrap justify-content-between">
                            <div class="left">
                                <h6 class="text-medium mb-10">Yearly Stats</h6>
                                <h3 class="text-bold">$245,479</h3>
                            </div>
                            <div class="right">
                                <div class="select-style-1">
                                    <div class="select-position select-sm">
                                        <select class="light-bg">
                                            <option value="">Yearly</option>
                                            <option value="">Monthly</option>
                                            <option value="">Weekly</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart">
                            <canvas id="Chart1" style="width: 100%; height: 400px; margin-left: -35px;"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="card-style mb-30">
                        <div class="title d-flex flex-wrap align-items-center justify-content-between">
                            <div class="left">
                                <h6 class="text-medium mb-30">Sales/Revenue</h6>
                            </div>
                            <div class="right">
                                <div class="select-style-1">
                                    <div class="select-position select-sm">
                                        <select class="light-bg">
                                            <option value="">Yearly</option>
                                            <option value="">Monthly</option>
                                            <option value="">Weekly</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart">
                            <canvas id="Chart2" style="width: 100%; height: 400px; margin-left: -45px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Sentiment Chart
            const sentimentChart = new Chart(document.getElementById('sentimentChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Positive üòä', 'Negative üòî', 'Neutral üòê'],
                    datasets: [{
                        data: [{{ sentimentStats.positive }}, {{ sentimentStats.negative }}, {{ sentimentStats.neutral }}],
                        backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                        borderColor: ['#28a745', '#dc3545', '#6c757d'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Sentiment Distribution'
                        }
                    }
                }
            });

            // Gestion du filtre de p√©riode
            const filterSelect = document.getElementById('sentimentFilter');
            filterSelect.addEventListener('change', function () {
                const period = this.value;
                fetch(`/admin/publication/sentiment-stats?period=${period}`, {
                    headers: { 'Accept': 'application/json' }
                })
                    .then(response => response.json())
                    .then(data => {
                        sentimentChart.data.datasets[0].data = [
                            data.sentimentStats.positive,
                            data.sentimentStats.negative,
                            data.sentimentStats.neutral
                        ];
                        sentimentChart.update();

                        // Mettre √† jour l'aper√ßu des sentiments
                        document.querySelector('.sentiment-positive').textContent = `${data.sentimentStats.positive}`;
                        document.querySelector('.sentiment-negative').textContent = `${data.sentimentStats.negative}`;
                        document.querySelector('.sentiment-neutral').textContent = `${data.sentimentStats.neutral}`;
                    })
                    .catch(error => console.error('Error fetching sentiment stats:', error));
            });

            // Gestion des checkboxes
            const checkAll = document.getElementById('checkAll');
            const checkboxes = document.querySelectorAll('.checkbox-item');

            if (checkAll) {
                checkAll.addEventListener('change', function () {
                    checkboxes.forEach(cb => cb.checked = this.checked);
                });
            }
        });
    </script>

    <style>
        .btn-mauve {
            background-color: #533C56;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .btn-mauve:hover {
            background-color: #99707E;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
        }

        .btn-mauve i {
            margin-right: 5px;
        }
    </style>
{% endblock %}