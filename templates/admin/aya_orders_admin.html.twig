{% extends 'admin/baseAdmin.html.twig' %}

{% block head %}
  <link rel="stylesheet" href="{{ asset('assetsAya/css/adminOrder.css') }}">
  {{ parent() }}
{% endblock %}

{% block section %}
<div class="admin-mui-wrapper">
  <h2>📋 Orders Management</h2>

  <!-- Filtres + Recherche + Export -->
  <div class="admin-filters">
    <div class="left-search">
      <input type="text" id="adminOrderSearch" placeholder="🔍 Search orders..." class="form-control">
    </div>

    <div class="center-filters">
      <button class="status-filter active" data-filter="">All</button>
      <button class="status-filter" data-filter="PENDING">Pending</button>
      <button class="status-filter" data-filter="CONFIRMED">Confirmed</button>
      <button class="status-filter" data-filter="CANCELLED">Cancelled</button>
      <button class="status-filter" data-filter="DELIVERED">Delivered</button>
    </div>

    <div class="right-actions">
      <button class="btn btn-outline-secondary" id="exportAdminCsvBtn">⬇️ Export CSV</button>
      <button class="btn btn-outline-danger" id="deleteAllOrdersBtn">🗑️ Delete All</button>
    </div>
  </div>

  <table class="admin-mui-table">
    <thead>
      <tr>
        <th>#ID</th>
        <th>User</th>
        <th>Status</th>
        <th>Total</th>
        <th>Ordered At</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody id="adminOrdersTable">
      {% for order in orders %}
        <tr data-status="{{ order.status }}">
          <td>{{ order.orderId }}</td>
          <td><strong>{{ order.user.username }}</strong></td>
          <td>
            <select class="status-select" data-id="{{ order.orderId }}">
              {% for status in ['PENDING', 'CONFIRMED', 'DELIVERED', 'CANCELLED'] %}
                <option value="{{ status }}" {% if order.status == status %}selected{% endif %}>
                  {{ status }}
                </option>
              {% endfor %}
            </select>
          </td>
          <td>{{ order.totalPrice }} DT</td>
          <td class="editable" data-id="{{ order.orderId }}" data-field="orderedAt">
            {{ order.orderedAt|date('Y-m-d') }}
          </td>
          <td>
            <button class="btn-delete delete-btn" data-id="{{ order.orderId }}">🗑️</button>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6" class="empty-row">No orders found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="{{ asset('assetsAya/js/ayaAdminOrders.js') }}"></script>
{% endblock %}
